!function(t,e){var n=function(){var e=t._data(document,"events");return e&&e.click&&t.grep(e.click,function(t){return"rails"===t.namespace}).length};n()&&t.error("jquery-ujs has already been loaded!");var i;t.rails=i={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote], a[data-disable-with]",inputChangeSelector:"select[data-remote], input[data-remote], textarea[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type])",disableSelector:"input[data-disable-with], button[data-disable-with], textarea[data-disable-with]",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled",requiredInputSelector:"input[name][required]:not([disabled]),textarea[name][required]:not([disabled])",fileInputSelector:"input[type=file]",linkDisableSelector:"a[data-disable-with]",CSRFProtection:function(e){var n=t('meta[name="csrf-token"]').attr("content");n&&e.setRequestHeader("X-CSRF-Token",n)},fire:function(e,n,i){var r=t.Event(n);return e.trigger(r,i),r.result!==!1},confirm:function(t){return confirm(t)},ajax:function(e){return t.ajax(e)},href:function(t){return t.attr("href")},handleRemote:function(n){var r,s,a,o,u,l,c,h;if(i.fire(n,"ajax:before")){if(o=n.data("cross-domain"),u=o===e?null:o,l=n.data("with-credentials")||null,c=n.data("type")||t.ajaxSettings&&t.ajaxSettings.dataType,n.is("form")){r=n.attr("method"),s=n.attr("action"),a=n.serializeArray();var d=n.data("ujs:submit-button");d&&(a.push(d),n.data("ujs:submit-button",null))}else n.is(i.inputChangeSelector)?(r=n.data("method"),s=n.data("url"),a=n.serialize(),n.data("params")&&(a=a+"&"+n.data("params"))):(r=n.data("method"),s=i.href(n),a=n.data("params")||null);h={type:r||"GET",data:a,dataType:c,beforeSend:function(t,r){return r.dataType===e&&t.setRequestHeader("accept","*/*;q=0.5, "+r.accepts.script),i.fire(n,"ajax:beforeSend",[t,r])},success:function(t,e,i){n.trigger("ajax:success",[t,e,i])},complete:function(t,e){n.trigger("ajax:complete",[t,e])},error:function(t,e,i){n.trigger("ajax:error",[t,e,i])},crossDomain:u},l&&(h.xhrFields={withCredentials:l}),s&&(h.url=s);var f=i.ajax(h);return n.trigger("ajax:send",f),f}return!1},handleMethod:function(n){var r=i.href(n),s=n.data("method"),a=n.attr("target"),o=t("meta[name=csrf-token]").attr("content"),u=t("meta[name=csrf-param]").attr("content"),l=t('<form method="post" action="'+r+'"></form>'),c='<input name="_method" value="'+s+'" type="hidden" />';u!==e&&o!==e&&(c+='<input name="'+u+'" value="'+o+'" type="hidden" />'),a&&l.attr("target",a),l.hide().append(c).appendTo("body"),l.submit()},disableFormElements:function(e){e.find(i.disableSelector).each(function(){var e=t(this),n=e.is("button")?"html":"val";e.data("ujs:enable-with",e[n]()),e[n](e.data("disable-with")),e.prop("disabled",!0)})},enableFormElements:function(e){e.find(i.enableSelector).each(function(){var e=t(this),n=e.is("button")?"html":"val";e.data("ujs:enable-with")&&e[n](e.data("ujs:enable-with")),e.prop("disabled",!1)})},allowAction:function(t){var e,n=t.data("confirm"),r=!1;return n?(i.fire(t,"confirm")&&(r=i.confirm(n),e=i.fire(t,"confirm:complete",[r])),r&&e):!0},blankInputs:function(e,n,i){var r,s,a=t(),o=n||"input,textarea",u=e.find(o);return u.each(function(){if(r=t(this),s=r.is("input[type=checkbox],input[type=radio]")?r.is(":checked"):r.val(),!s==!i){if(r.is("input[type=radio]")&&u.filter('input[type=radio]:checked[name="'+r.attr("name")+'"]').length)return!0;a=a.add(r)}}),a.length?a:!1},nonBlankInputs:function(t,e){return i.blankInputs(t,e,!0)},stopEverything:function(e){return t(e.target).trigger("ujs:everythingStopped"),e.stopImmediatePropagation(),!1},callFormSubmitBindings:function(n,i){var r=n.data("events"),s=!0;return r!==e&&r.submit!==e&&t.each(r.submit,function(t,e){return"function"==typeof e.handler?s=e.handler(i):void 0}),s},disableElement:function(t){t.data("ujs:enable-with",t.html()),t.html(t.data("disable-with")),t.bind("click.railsDisable",function(t){return i.stopEverything(t)})},enableElement:function(t){t.data("ujs:enable-with")!==e&&(t.html(t.data("ujs:enable-with")),t.data("ujs:enable-with",!1)),t.unbind("click.railsDisable")}},i.fire(t(document),"rails:attachBindings")&&(t.ajaxPrefilter(function(t,e,n){t.crossDomain||i.CSRFProtection(n)}),t(document).delegate(i.linkDisableSelector,"ajax:complete",function(){i.enableElement(t(this))}),t(document).delegate(i.linkClickSelector,"click.rails",function(n){var r=t(this),s=r.data("method"),a=r.data("params");if(!i.allowAction(r))return i.stopEverything(n);if(r.is(i.linkDisableSelector)&&i.disableElement(r),r.data("remote")!==e){if(!(!n.metaKey&&!n.ctrlKey||s&&"GET"!==s||a))return!0;var o=i.handleRemote(r);return o===!1?i.enableElement(r):o.error(function(){i.enableElement(r)}),!1}return r.data("method")?(i.handleMethod(r),!1):void 0}),t(document).delegate(i.inputChangeSelector,"change.rails",function(e){var n=t(this);return i.allowAction(n)?(i.handleRemote(n),!1):i.stopEverything(e)}),t(document).delegate(i.formSubmitSelector,"submit.rails",function(n){var r=t(this),s=r.data("remote")!==e,a=i.blankInputs(r,i.requiredInputSelector),o=i.nonBlankInputs(r,i.fileInputSelector);if(!i.allowAction(r))return i.stopEverything(n);if(a&&r.attr("novalidate")==e&&i.fire(r,"ajax:aborted:required",[a]))return i.stopEverything(n);if(s){if(o){setTimeout(function(){i.disableFormElements(r)},13);var u=i.fire(r,"ajax:aborted:file",[o]);return u||setTimeout(function(){i.enableFormElements(r)},13),u}return!t.support.submitBubbles&&t().jquery<"1.7"&&i.callFormSubmitBindings(r,n)===!1?i.stopEverything(n):(i.handleRemote(r),!1)}setTimeout(function(){i.disableFormElements(r)},13)}),t(document).delegate(i.formInputClickSelector,"click.rails",function(e){var n=t(this);if(!i.allowAction(n))return i.stopEverything(e);var r=n.attr("name"),s=r?{name:r,value:n.val()}:null;n.closest("form").data("ujs:submit-button",s)}),t(document).delegate(i.formSubmitSelector,"ajax:beforeSend.rails",function(e){this==e.target&&i.disableFormElements(t(this))}),t(document).delegate(i.formSubmitSelector,"ajax:complete.rails",function(e){this==e.target&&i.enableFormElements(t(this))}),t(function(){var e=t("meta[name=csrf-token]").attr("content"),n=t("meta[name=csrf-param]").attr("content");t('form input[name="'+n+'"]').val(e)}))}(jQuery),function(){function t(e,n,i){if(e===n)return 0!==e||1/e==1/n;if(null==e||null==n)return e===n;if(e._chain&&(e=e._wrapped),n._chain&&(n=n._wrapped),e.isEqual&&E.isFunction(e.isEqual))return e.isEqual(n);if(n.isEqual&&E.isFunction(n.isEqual))return n.isEqual(e);var r=l.call(e);if(r!=l.call(n))return!1;switch(r){case"[object String]":return e==String(n);case"[object Number]":return e!=+e?n!=+n:0==e?1/e==1/n:e==+n;case"[object Date]":case"[object Boolean]":return+e==+n;case"[object RegExp]":return e.source==n.source&&e.global==n.global&&e.multiline==n.multiline&&e.ignoreCase==n.ignoreCase}if("object"!=typeof e||"object"!=typeof n)return!1;for(var s=i.length;s--;)if(i[s]==e)return!0;i.push(e);var a=0,o=!0;if("[object Array]"==r){if(a=e.length,o=a==n.length)for(;a--&&(o=a in e==a in n&&t(e[a],n[a],i)););}else{if("constructor"in e!="constructor"in n||e.constructor!=n.constructor)return!1;for(var u in e)if(E.has(e,u)&&(a++,!(o=E.has(n,u)&&t(e[u],n[u],i))))break;if(o){for(u in n)if(E.has(n,u)&&!a--)break;o=!a}}return i.pop(),o}var e=this,n=e._,i={},r=Array.prototype,s=Object.prototype,a=Function.prototype,o=r.slice,u=r.unshift,l=s.toString,c=s.hasOwnProperty,h=r.forEach,d=r.map,f=r.reduce,p=r.reduceRight,g=r.filter,m=r.every,v=r.some,y=r.indexOf,b=r.lastIndexOf,_=Array.isArray,w=Object.keys,x=a.bind,E=function(t){return new F(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=E),exports._=E):e._=E,E.VERSION="1.3.3";var S=E.each=E.forEach=function(t,e,n){if(null!=t)if(h&&t.forEach===h)t.forEach(e,n);else if(t.length===+t.length){for(var r=0,s=t.length;s>r;r++)if(r in t&&e.call(n,t[r],r,t)===i)return}else for(var a in t)if(E.has(t,a)&&e.call(n,t[a],a,t)===i)return};E.map=E.collect=function(t,e,n){var i=[];return null==t?i:d&&t.map===d?t.map(e,n):(S(t,function(t,r,s){i[i.length]=e.call(n,t,r,s)}),t.length===+t.length&&(i.length=t.length),i)},E.reduce=E.foldl=E.inject=function(t,e,n,i){var r=arguments.length>2;if(null==t&&(t=[]),f&&t.reduce===f)return i&&(e=E.bind(e,i)),r?t.reduce(e,n):t.reduce(e);if(S(t,function(t,s,a){r?n=e.call(i,n,t,s,a):(n=t,r=!0)}),!r)throw new TypeError("Reduce of empty array with no initial value");return n},E.reduceRight=E.foldr=function(t,e,n,i){var r=arguments.length>2;if(null==t&&(t=[]),p&&t.reduceRight===p)return i&&(e=E.bind(e,i)),r?t.reduceRight(e,n):t.reduceRight(e);var s=E.toArray(t).reverse();return i&&!r&&(e=E.bind(e,i)),r?E.reduce(s,e,n,i):E.reduce(s,e)},E.find=E.detect=function(t,e,n){var i;return k(t,function(t,r,s){return e.call(n,t,r,s)?(i=t,!0):void 0}),i},E.filter=E.select=function(t,e,n){var i=[];return null==t?i:g&&t.filter===g?t.filter(e,n):(S(t,function(t,r,s){e.call(n,t,r,s)&&(i[i.length]=t)}),i)},E.reject=function(t,e,n){var i=[];return null==t?i:(S(t,function(t,r,s){e.call(n,t,r,s)||(i[i.length]=t)}),i)},E.every=E.all=function(t,e,n){var r=!0;return null==t?r:m&&t.every===m?t.every(e,n):(S(t,function(t,s,a){return(r=r&&e.call(n,t,s,a))?void 0:i}),!!r)};var k=E.some=E.any=function(t,e,n){e||(e=E.identity);var r=!1;return null==t?r:v&&t.some===v?t.some(e,n):(S(t,function(t,s,a){return r||(r=e.call(n,t,s,a))?i:void 0}),!!r)};E.include=E.contains=function(t,e){var n=!1;return null==t?n:y&&t.indexOf===y?-1!=t.indexOf(e):n=k(t,function(t){return t===e})},E.invoke=function(t,e){var n=o.call(arguments,2);return E.map(t,function(t){return(E.isFunction(e)?e||t:t[e]).apply(t,n)})},E.pluck=function(t,e){return E.map(t,function(t){return t[e]})},E.max=function(t,e,n){if(!e&&E.isArray(t)&&t[0]===+t[0])return Math.max.apply(Math,t);if(!e&&E.isEmpty(t))return-1/0;var i={computed:-1/0};return S(t,function(t,r,s){var a=e?e.call(n,t,r,s):t;a>=i.computed&&(i={value:t,computed:a})}),i.value},E.min=function(t,e,n){if(!e&&E.isArray(t)&&t[0]===+t[0])return Math.min.apply(Math,t);if(!e&&E.isEmpty(t))return 1/0;var i={computed:1/0};return S(t,function(t,r,s){var a=e?e.call(n,t,r,s):t;a<i.computed&&(i={value:t,computed:a})}),i.value},E.shuffle=function(t){var e,n=[];return S(t,function(t,i){e=Math.floor(Math.random()*(i+1)),n[i]=n[e],n[e]=t}),n},E.sortBy=function(t,e,n){var i=E.isFunction(e)?e:function(t){return t[e]};return E.pluck(E.map(t,function(t,e,r){return{value:t,criteria:i.call(n,t,e,r)}}).sort(function(t,e){var n=t.criteria,i=e.criteria;return void 0===n?1:void 0===i?-1:i>n?-1:n>i?1:0}),"value")},E.groupBy=function(t,e){var n={},i=E.isFunction(e)?e:function(t){return t[e]};return S(t,function(t,e){var r=i(t,e);(n[r]||(n[r]=[])).push(t)}),n},E.sortedIndex=function(t,e,n){n||(n=E.identity);for(var i=0,r=t.length;r>i;){var s=i+r>>1;n(t[s])<n(e)?i=s+1:r=s}return i},E.toArray=function(t){return t?E.isArray(t)?o.call(t):E.isArguments(t)?o.call(t):t.toArray&&E.isFunction(t.toArray)?t.toArray():E.values(t):[]},E.size=function(t){return E.isArray(t)?t.length:E.keys(t).length},E.first=E.head=E.take=function(t,e,n){return null==e||n?t[0]:o.call(t,0,e)},E.initial=function(t,e,n){return o.call(t,0,t.length-(null==e||n?1:e))},E.last=function(t,e,n){return null==e||n?t[t.length-1]:o.call(t,Math.max(t.length-e,0))},E.rest=E.tail=function(t,e,n){return o.call(t,null==e||n?1:e)},E.compact=function(t){return E.filter(t,function(t){return!!t})},E.flatten=function(t,e){return E.reduce(t,function(t,n){return E.isArray(n)?t.concat(e?n:E.flatten(n)):(t[t.length]=n,t)},[])},E.without=function(t){return E.difference(t,o.call(arguments,1))},E.uniq=E.unique=function(t,e,n){var i=n?E.map(t,n):t,r=[];return t.length<3&&(e=!0),E.reduce(i,function(n,i,s){return(e?E.last(n)===i&&n.length:E.include(n,i))||(n.push(i),r.push(t[s])),n},[]),r},E.union=function(){return E.uniq(E.flatten(arguments,!0))},E.intersection=E.intersect=function(t){var e=o.call(arguments,1);return E.filter(E.uniq(t),function(t){return E.every(e,function(e){return E.indexOf(e,t)>=0})})},E.difference=function(t){var e=E.flatten(o.call(arguments,1),!0);return E.filter(t,function(t){return!E.include(e,t)})},E.zip=function(){for(var t=o.call(arguments),e=E.max(E.pluck(t,"length")),n=new Array(e),i=0;e>i;i++)n[i]=E.pluck(t,""+i);return n},E.indexOf=function(t,e,n){if(null==t)return-1;var i,r;if(n)return i=E.sortedIndex(t,e),t[i]===e?i:-1;if(y&&t.indexOf===y)return t.indexOf(e);for(i=0,r=t.length;r>i;i++)if(i in t&&t[i]===e)return i;return-1},E.lastIndexOf=function(t,e){if(null==t)return-1;if(b&&t.lastIndexOf===b)return t.lastIndexOf(e);for(var n=t.length;n--;)if(n in t&&t[n]===e)return n;return-1},E.range=function(t,e,n){arguments.length<=1&&(e=t||0,t=0),n=arguments[2]||1;for(var i=Math.max(Math.ceil((e-t)/n),0),r=0,s=new Array(i);i>r;)s[r++]=t,t+=n;return s};var A=function(){};E.bind=function(t,e){var n,i;if(t.bind===x&&x)return x.apply(t,o.call(arguments,1));if(!E.isFunction(t))throw new TypeError;return i=o.call(arguments,2),n=function(){if(!(this instanceof n))return t.apply(e,i.concat(o.call(arguments)));A.prototype=t.prototype;var r=new A,s=t.apply(r,i.concat(o.call(arguments)));return Object(s)===s?s:r}},E.bindAll=function(t){var e=o.call(arguments,1);return 0==e.length&&(e=E.functions(t)),S(e,function(e){t[e]=E.bind(t[e],t)}),t},E.memoize=function(t,e){var n={};return e||(e=E.identity),function(){var i=e.apply(this,arguments);return E.has(n,i)?n[i]:n[i]=t.apply(this,arguments)}},E.delay=function(t,e){var n=o.call(arguments,2);return setTimeout(function(){return t.apply(null,n)},e)},E.defer=function(t){return E.delay.apply(E,[t,1].concat(o.call(arguments,1)))},E.throttle=function(t,e){var n,i,r,s,a,o,u=E.debounce(function(){a=s=!1},e);return function(){n=this,i=arguments;var l=function(){r=null,a&&t.apply(n,i),u()};return r||(r=setTimeout(l,e)),s?a=!0:o=t.apply(n,i),u(),s=!0,o}},E.debounce=function(t,e,n){var i;return function(){var r=this,s=arguments,a=function(){i=null,n||t.apply(r,s)};n&&!i&&t.apply(r,s),clearTimeout(i),i=setTimeout(a,e)}},E.once=function(t){var e,n=!1;return function(){return n?e:(n=!0,e=t.apply(this,arguments))}},E.wrap=function(t,e){return function(){var n=[t].concat(o.call(arguments,0));return e.apply(this,n)}},E.compose=function(){var t=arguments;return function(){for(var e=arguments,n=t.length-1;n>=0;n--)e=[t[n].apply(this,e)];return e[0]}},E.after=function(t,e){return 0>=t?e():function(){return--t<1?e.apply(this,arguments):void 0}},E.keys=w||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var n in t)E.has(t,n)&&(e[e.length]=n);return e},E.values=function(t){return E.map(t,E.identity)},E.functions=E.methods=function(t){var e=[];for(var n in t)E.isFunction(t[n])&&e.push(n);return e.sort()},E.extend=function(t){return S(o.call(arguments,1),function(e){for(var n in e)t[n]=e[n]}),t},E.pick=function(t){var e={};return S(E.flatten(o.call(arguments,1)),function(n){n in t&&(e[n]=t[n])}),e},E.defaults=function(t){return S(o.call(arguments,1),function(e){for(var n in e)null==t[n]&&(t[n]=e[n])}),t},E.clone=function(t){return E.isObject(t)?E.isArray(t)?t.slice():E.extend({},t):t},E.tap=function(t,e){return e(t),t},E.isEqual=function(e,n){return t(e,n,[])},E.isEmpty=function(t){if(null==t)return!0;if(E.isArray(t)||E.isString(t))return 0===t.length;for(var e in t)if(E.has(t,e))return!1;return!0},E.isElement=function(t){return!(!t||1!=t.nodeType)},E.isArray=_||function(t){return"[object Array]"==l.call(t)},E.isObject=function(t){return t===Object(t)},E.isArguments=function(t){return"[object Arguments]"==l.call(t)},E.isArguments(arguments)||(E.isArguments=function(t){return!(!t||!E.has(t,"callee"))}),E.isFunction=function(t){return"[object Function]"==l.call(t)},E.isString=function(t){return"[object String]"==l.call(t)},E.isNumber=function(t){return"[object Number]"==l.call(t)},E.isFinite=function(t){return E.isNumber(t)&&isFinite(t)},E.isNaN=function(t){return t!==t},E.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"==l.call(t)},E.isDate=function(t){return"[object Date]"==l.call(t)},E.isRegExp=function(t){return"[object RegExp]"==l.call(t)},E.isNull=function(t){return null===t},E.isUndefined=function(t){return void 0===t},E.has=function(t,e){return c.call(t,e)},E.noConflict=function(){return e._=n,this},E.identity=function(t){return t},E.times=function(t,e,n){for(var i=0;t>i;i++)e.call(n,i)},E.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},E.result=function(t,e){if(null==t)return null;var n=t[e];return E.isFunction(n)?n.call(t):n},E.mixin=function(t){S(E.functions(t),function(e){$(e,E[e]=t[e])})};var j=0;E.uniqueId=function(t){var e=j++;return t?t+e:e},E.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var T=/.^/,M={"\\":"\\","'":"'",r:"\r",n:"\n",t:"	",u2028:"\u2028",u2029:"\u2029"};for(var O in M)M[M[O]]=O;var I=/\\|'|\r|\n|\t|\u2028|\u2029/g,P=/\\(\\|'|r|n|t|u2028|u2029)/g,C=function(t){return t.replace(P,function(t,e){return M[e]})};E.template=function(t,e,n){n=E.defaults(n||{},E.templateSettings);var i="__p+='"+t.replace(I,function(t){return"\\"+M[t]}).replace(n.escape||T,function(t,e){return"'+\n_.escape("+C(e)+")+\n'"}).replace(n.interpolate||T,function(t,e){return"'+\n("+C(e)+")+\n'"}).replace(n.evaluate||T,function(t,e){return"';\n"+C(e)+"\n;__p+='"})+"';\n";n.variable||(i="with(obj||{}){\n"+i+"}\n"),i="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+i+"return __p;\n";var r=new Function(n.variable||"obj","_",i);if(e)return r(e,E);var s=function(t){return r.call(this,t,E)};return s.source="function("+(n.variable||"obj")+"){\n"+i+"}",s},E.chain=function(t){return E(t).chain()};var F=function(t){this._wrapped=t};E.prototype=F.prototype;var R=function(t,e){return e?E(t).chain():t},$=function(t,e){F.prototype[t]=function(){var t=o.call(arguments);return u.call(t,this._wrapped),R(e.apply(E,t),this._chain)}};E.mixin(E),S(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=r[t];F.prototype[t]=function(){var n=this._wrapped;e.apply(n,arguments);var i=n.length;return"shift"!=t&&"splice"!=t||0!==i||delete n[0],R(n,this._chain)}}),S(["concat","join","slice"],function(t){var e=r[t];F.prototype[t]=function(){return R(e.apply(this._wrapped,arguments),this._chain)}}),F.prototype.chain=function(){return this._chain=!0,this},F.prototype.value=function(){return this._wrapped}}.call(this),function(){var t,e=this,n=e.Backbone,i=Array.prototype.slice,r=Array.prototype.splice;t="undefined"!=typeof exports?exports:e.Backbone={},t.VERSION="0.9.2";var s=e._;s||"undefined"==typeof require||(s=require("underscore"));var a=e.jQuery||e.Zepto||e.ender;t.setDomLibrary=function(t){a=t},t.noConflict=function(){return e.Backbone=n,this},t.emulateHTTP=!1,t.emulateJSON=!1;var o=/\s+/,u=t.Events={on:function(t,e,n){var i,r,s,a,u;if(!e)return this;for(t=t.split(o),i=this._callbacks||(this._callbacks={});r=t.shift();)u=i[r],s=u?u.tail:{},s.next=a={},s.context=n,s.callback=e,i[r]={tail:a,next:u?u.next:s};return this},off:function(t,e,n){var i,r,a,u,l,c;if(r=this._callbacks){if(!(t||e||n))return delete this._callbacks,this;for(t=t?t.split(o):s.keys(r);i=t.shift();)if(a=r[i],delete r[i],a&&(e||n))for(u=a.tail;(a=a.next)!==u;)l=a.callback,c=a.context,(e&&l!==e||n&&c!==n)&&this.on(i,l,c);return this}},trigger:function(t){var e,n,r,s,a,u,l;if(!(r=this._callbacks))return this;for(u=r.all,t=t.split(o),l=i.call(arguments,1);e=t.shift();){if(n=r[e])for(s=n.tail;(n=n.next)!==s;)n.callback.apply(n.context||this,l);if(n=u)for(s=n.tail,a=[e].concat(l);(n=n.next)!==s;)n.callback.apply(n.context||this,a)}return this}};u.bind=u.on,u.unbind=u.off;var l=t.Model=function(t,e){var n;t||(t={}),e&&e.parse&&(t=this.parse(t)),(n=A(this,"defaults"))&&(t=s.extend({},n,t)),e&&e.collection&&(this.collection=e.collection),this.attributes={},this._escapedAttributes={},this.cid=s.uniqueId("c"),this.changed={},this._silent={},this._pending={},this.set(t,{silent:!0}),this.changed={},this._silent={},this._pending={},this._previousAttributes=s.clone(this.attributes),this.initialize.apply(this,arguments)};s.extend(l.prototype,u,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(){return s.clone(this.attributes)},get:function(t){return this.attributes[t]},escape:function(t){var e;if(e=this._escapedAttributes[t])return e;var n=this.get(t);return this._escapedAttributes[t]=s.escape(null==n?"":""+n)},has:function(t){return null!=this.get(t)},set:function(t,e,n){var i,r,a;if(s.isObject(t)||null==t?(i=t,n=e):(i={},i[t]=e),n||(n={}),!i)return this;if(i instanceof l&&(i=i.attributes),n.unset)for(r in i)i[r]=void 0;if(!this._validate(i,n))return!1;this.idAttribute in i&&(this.id=i[this.idAttribute]);var o=n.changes={},u=this.attributes,c=this._escapedAttributes,h=this._previousAttributes||{};for(r in i)a=i[r],(!s.isEqual(u[r],a)||n.unset&&s.has(u,r))&&(delete c[r],(n.silent?this._silent:o)[r]=!0),n.unset?delete u[r]:u[r]=a,s.isEqual(h[r],a)&&s.has(u,r)==s.has(h,r)?(delete this.changed[r],delete this._pending[r]):(this.changed[r]=a,n.silent||(this._pending[r]=!0));return n.silent||this.change(n),this},unset:function(t,e){return(e||(e={})).unset=!0,this.set(t,null,e)},clear:function(t){return(t||(t={})).unset=!0,this.set(s.clone(this.attributes),t)},fetch:function(e){e=e?s.clone(e):{};var n=this,i=e.success;return e.success=function(t,r,s){return n.set(n.parse(t,s),e)?(i&&i(n,t),void 0):!1},e.error=t.wrapError(e.error,n,e),(this.sync||t.sync).call(this,"read",this,e)},save:function(e,n,i){var r,a;if(s.isObject(e)||null==e?(r=e,i=n):(r={},r[e]=n),i=i?s.clone(i):{},i.wait){if(!this._validate(r,i))return!1;a=s.clone(this.attributes)}var o=s.extend({},i,{silent:!0});if(r&&!this.set(r,i.wait?o:i))return!1;var u=this,l=i.success;i.success=function(t,e,n){var a=u.parse(t,n);return i.wait&&(delete i.wait,a=s.extend(r||{},a)),u.set(a,i)?(l?l(u,t):u.trigger("sync",u,t,i),void 0):!1},i.error=t.wrapError(i.error,u,i);var c=this.isNew()?"create":"update",h=(this.sync||t.sync).call(this,c,this,i);return i.wait&&this.set(a,o),h},destroy:function(e){e=e?s.clone(e):{};var n=this,i=e.success,r=function(){n.trigger("destroy",n,n.collection,e)};if(this.isNew())return r(),!1;e.success=function(t){e.wait&&r(),i?i(n,t):n.trigger("sync",n,t,e)},e.error=t.wrapError(e.error,n,e);var a=(this.sync||t.sync).call(this,"delete",this,e);return e.wait||r(),a},url:function(){var t=A(this,"urlRoot")||A(this.collection,"url")||j();return this.isNew()?t:t+("/"==t.charAt(t.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(t){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},change:function(t){t||(t={});var e=this._changing;this._changing=!0;for(var n in this._silent)this._pending[n]=!0;var i=s.extend({},t.changes,this._silent);this._silent={};for(var n in i)this.trigger("change:"+n,this,this.get(n),t);if(e)return this;for(;!s.isEmpty(this._pending);){this._pending={},this.trigger("change",this,t);for(var n in this.changed)this._pending[n]||this._silent[n]||delete this.changed[n];this._previousAttributes=s.clone(this.attributes)}return this._changing=!1,this},hasChanged:function(t){return arguments.length?s.has(this.changed,t):!s.isEmpty(this.changed)},changedAttributes:function(t){if(!t)return this.hasChanged()?s.clone(this.changed):!1;var e,n=!1,i=this._previousAttributes;for(var r in t)s.isEqual(i[r],e=t[r])||((n||(n={}))[r]=e);return n},previous:function(t){return arguments.length&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return s.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(t,e){if(e.silent||!this.validate)return!0;t=s.extend({},this.attributes,t);var n=this.validate(t,e);return n?(e&&e.error?e.error(this,n,e):this.trigger("error",this,n,e),!1):!0}});var c=t.Collection=function(t,e){e||(e={}),e.model&&(this.model=e.model),e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,{silent:!0,parse:e.parse})};s.extend(c.prototype,u,{model:l,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},add:function(t,e){var n,i,a,o,u,l,c={},h={},d=[];for(e||(e={}),t=s.isArray(t)?t.slice():[t],n=0,a=t.length;a>n;n++){if(!(o=t[n]=this._prepareModel(t[n],e)))throw new Error("Can't add an invalid model to a collection");u=o.cid,l=o.id,c[u]||this._byCid[u]||null!=l&&(h[l]||this._byId[l])?d.push(n):c[u]=h[l]=o}for(n=d.length;n--;)t.splice(d[n],1);for(n=0,a=t.length;a>n;n++)(o=t[n]).on("all",this._onModelEvent,this),this._byCid[o.cid]=o,null!=o.id&&(this._byId[o.id]=o);if(this.length+=a,i=null!=e.at?e.at:this.models.length,r.apply(this.models,[i,0].concat(t)),this.comparator&&this.sort({silent:!0}),e.silent)return this;for(n=0,a=this.models.length;a>n;n++)c[(o=this.models[n]).cid]&&(e.index=n,o.trigger("add",o,this,e));return this},remove:function(t,e){var n,i,r,a;for(e||(e={}),t=s.isArray(t)?t.slice():[t],n=0,i=t.length;i>n;n++)a=this.getByCid(t[n])||this.get(t[n]),a&&(delete this._byId[a.id],delete this._byCid[a.cid],r=this.indexOf(a),this.models.splice(r,1),this.length--,e.silent||(e.index=r,a.trigger("remove",a,this,e)),this._removeReference(a));return this},push:function(t,e){return t=this._prepareModel(t,e),this.add(t,e),t},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t),e},unshift:function(t,e){return t=this._prepareModel(t,e),this.add(t,s.extend({at:0},e)),t},shift:function(t){var e=this.at(0);return this.remove(e,t),e},get:function(t){return null==t?void 0:this._byId[null!=t.id?t.id:t]},getByCid:function(t){return t&&this._byCid[t.cid||t]},at:function(t){return this.models[t]},where:function(t){return s.isEmpty(t)?[]:this.filter(function(e){for(var n in t)if(t[n]!==e.get(n))return!1;return!0})},sort:function(t){if(t||(t={}),!this.comparator)throw new Error("Cannot sort a set without a comparator");var e=s.bind(this.comparator,this);return 1==this.comparator.length?this.models=this.sortBy(e):this.models.sort(e),t.silent||this.trigger("reset",this,t),this},pluck:function(t){return s.map(this.models,function(e){return e.get(t)})},reset:function(t,e){t||(t=[]),e||(e={});for(var n=0,i=this.models.length;i>n;n++)this._removeReference(this.models[n]);return this._reset(),this.add(t,s.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),this},fetch:function(e){e=e?s.clone(e):{},void 0===e.parse&&(e.parse=!0);var n=this,i=e.success;return e.success=function(t,r,s){n[e.add?"add":"reset"](n.parse(t,s),e),i&&i(n,t)},e.error=t.wrapError(e.error,n,e),(this.sync||t.sync).call(this,"read",this,e)},create:function(t,e){var n=this;if(e=e?s.clone(e):{},t=this._prepareModel(t,e),!t)return!1;e.wait||n.add(t,e);var i=e.success;return e.success=function(r,s){e.wait&&n.add(r,e),i?i(r,s):r.trigger("sync",t,s,e)},t.save(null,e),t},parse:function(t){return t},chain:function(){return s(this.models).chain()},_reset:function(){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(t,e){if(e||(e={}),t instanceof l)t.collection||(t.collection=this);else{var n=t;e.collection=this,t=new this.model(n,e),t._validate(t.attributes,e)||(t=!1)}return t},_removeReference:function(t){this==t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,n,i){("add"!=t&&"remove"!=t||n==this)&&("destroy"==t&&this.remove(e,i),e&&t==="change:"+e.idAttribute&&(delete this._byId[e.previous(e.idAttribute)],this._byId[e.id]=e),this.trigger.apply(this,arguments))}});var h=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];s.each(h,function(t){c.prototype[t]=function(){return s[t].apply(s,[this.models].concat(s.toArray(arguments)))}});var d=t.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},f=/:\w+/g,p=/\*\w+/g,g=/[-[\]{}()+?.,\\^$|#\s]/g;s.extend(d.prototype,u,{initialize:function(){},route:function(e,n,i){return t.history||(t.history=new m),s.isRegExp(e)||(e=this._routeToRegExp(e)),i||(i=this[n]),t.history.route(e,s.bind(function(r){var s=this._extractParameters(e,r);i&&i.apply(this,s),this.trigger.apply(this,["route:"+n].concat(s)),t.history.trigger("route",this,n,s)},this)),this},navigate:function(e,n){t.history.navigate(e,n)},_bindRoutes:function(){if(this.routes){var t=[];for(var e in this.routes)t.unshift([e,this.routes[e]]);for(var n=0,i=t.length;i>n;n++)this.route(t[n][0],t[n][1],this[t[n][1]])}},_routeToRegExp:function(t){return t=t.replace(g,"\\$&").replace(f,"([^/]+)").replace(p,"(.*?)"),new RegExp("^"+t+"$")},_extractParameters:function(t,e){return t.exec(e).slice(1)}});var m=t.History=function(){this.handlers=[],s.bindAll(this,"checkUrl")},v=/^[#\/]/,y=/msie [\w.]+/;m.started=!1,s.extend(m.prototype,u,{interval:50,getHash:function(t){var e=t?t.location:window.location,n=e.href.match(/#(.*)$/);return n?n[1]:""},getFragment:function(t,e){if(null==t)if(this._hasPushState||e){t=window.location.pathname;var n=window.location.search;n&&(t+=n)}else t=this.getHash();return t.indexOf(this.options.root)||(t=t.substr(this.options.root.length)),t.replace(v,"")},start:function(t){if(m.started)throw new Error("Backbone.history has already been started");m.started=!0,this.options=s.extend({},{root:"/"},this.options,t),this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var e=this.getFragment(),n=document.documentMode,i=y.exec(navigator.userAgent.toLowerCase())&&(!n||7>=n);i&&(this.iframe=a('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(e)),this._hasPushState?a(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!i?a(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=e;var r=window.location,o=r.pathname==this.options.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!o?(this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&o&&r.hash&&(this.fragment=this.getHash().replace(v,""),window.history.replaceState({},document.title,r.protocol+"//"+r.host+this.options.root+this.fragment)),this.options.silent?void 0:this.loadUrl())},stop:function(){a(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),m.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(){var t=this.getFragment();return t==this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t==this.fragment?!1:(this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash()),void 0)},loadUrl:function(t){var e=this.fragment=this.getFragment(t),n=s.any(this.handlers,function(t){return t.route.test(e)?(t.callback(e),!0):void 0});return n},navigate:function(t,e){if(!m.started)return!1;e&&e!==!0||(e={trigger:e});var n=(t||"").replace(v,"");this.fragment!=n&&(this._hasPushState?(0!=n.indexOf(this.options.root)&&(n=this.options.root+n),this.fragment=n,window.history[e.replace?"replaceState":"pushState"]({},document.title,n)):this._wantsHashChange?(this.fragment=n,this._updateHash(window.location,n,e.replace),this.iframe&&n!=this.getFragment(this.getHash(this.iframe))&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,n,e.replace))):window.location.assign(this.options.root+t),e.trigger&&this.loadUrl(t))},_updateHash:function(t,e,n){n?t.replace(t.toString().replace(/(javascript:|#).*$/,"")+"#"+e):t.hash=e}});var b=t.View=function(t){this.cid=s.uniqueId("view"),this._configure(t||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},_=/^(\S+)\s*(.*)$/,w=["model","collection","el","id","attributes","className","tagName"];s.extend(b.prototype,u,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this
},remove:function(){return this.$el.remove(),this},make:function(t,e,n){var i=document.createElement(t);return e&&a(i).attr(e),n&&a(i).html(n),i},setElement:function(t,e){return this.$el&&this.undelegateEvents(),this.$el=t instanceof a?t:a(t),this.el=this.$el[0],e!==!1&&this.delegateEvents(),this},delegateEvents:function(t){if(t||(t=A(this,"events"))){this.undelegateEvents();for(var e in t){var n=t[e];if(s.isFunction(n)||(n=this[t[e]]),!n)throw new Error('Method "'+t[e]+'" does not exist');var i=e.match(_),r=i[1],a=i[2];n=s.bind(n,this),r+=".delegateEvents"+this.cid,""===a?this.$el.bind(r,n):this.$el.delegate(a,r,n)}}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(t){this.options&&(t=s.extend({},this.options,t));for(var e=0,n=w.length;n>e;e++){var i=w[e];t[i]&&(this[i]=t[i])}this.options=t},_ensureElement:function(){if(this.el)this.setElement(this.el,!1);else{var t=A(this,"attributes")||{};this.id&&(t.id=this.id),this.className&&(t["class"]=this.className),this.setElement(this.make(this.tagName,t),!1)}}});var x=function(t,e){var n=k(this,t,e);return n.extend=this.extend,n};l.extend=c.extend=d.extend=b.extend=x;var E={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};t.sync=function(e,n,i){var r=E[e];i||(i={});var o={type:r,dataType:"json"};return i.url||(o.url=A(n,"url")||j()),i.data||!n||"create"!=e&&"update"!=e||(o.contentType="application/json",o.data=JSON.stringify(n.toJSON())),t.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{}),t.emulateHTTP&&("PUT"===r||"DELETE"===r)&&(t.emulateJSON&&(o.data._method=r),o.type="POST",o.beforeSend=function(t){t.setRequestHeader("X-HTTP-Method-Override",r)}),"GET"===o.type||t.emulateJSON||(o.processData=!1),a.ajax(s.extend(o,i))},t.wrapError=function(t,e,n){return function(i,r){r=i===e?r:i,t?t(e,r,n):e.trigger("error",e,r,n)}};var S=function(){},k=function(t,e,n){var i;return i=e&&e.hasOwnProperty("constructor")?e.constructor:function(){t.apply(this,arguments)},s.extend(i,t),S.prototype=t.prototype,i.prototype=new S,e&&s.extend(i.prototype,e),n&&s.extend(i,n),i.prototype.constructor=i,i.__super__=t.prototype,i},A=function(t,e){return t&&t[e]?s.isFunction(t[e])?t[e]():t[e]:null},j=function(){throw new Error('A "url" property or function must be specified')}}.call(this),function(){var t={create:"POST",update:"PUT","delete":"DELETE",read:"GET"},e=function(t){return t&&t.url?_.isFunction(t.url)?t.url():t.url:null},n=function(){throw new Error("A 'url' property or function must be specified")};Backbone.sync=function(i,r,s){var a=t[i],o=_.extend({type:a,dataType:"json",beforeSend:function(t){var e=$('meta[name="csrf-token"]').attr("content");e&&t.setRequestHeader("X-CSRF-Token",e),r.trigger("sync:start")}},s);if(o.url||(o.url=e(r)||n()),!o.data&&r&&("create"==i||"update"==i)){o.contentType="application/json";var u={};r.paramRoot?u[r.paramRoot]=r.toJSON():u=r.toJSON(),o.data=JSON.stringify(u)}"GET"!==o.type&&(o.processData=!1);var l=s.complete;return o.complete=function(t,e){r.trigger("sync:end"),l&&l(t,e)},$.ajax(o)}}.call(this),function(t){return t.extend(t.fn,{backboneLink:function(e){return t(this).find(":input").each(function(){var n,i;return n=t(this),i=n.attr("name"),e.bind("change:"+i,function(){return n.val(e.get(i))}),t(this).bind("change",function(){var i;return n=t(this),i={},i[n.attr("name")]=n.val(),e.set(i)})})}})}(jQuery),function(){window.Musiclist={Models:{},Collections:{},Routers:{},Views:{}}}.call(this),function(){this.JST||(this.JST={}),this.JST["backbone/templates/playlists/album"]=function(obj){var __p=[];with(obj||{})__p.push('<td class="number">',position,'</td>\n<td><span class="artist">',artist,"</span> - ",title,'</td>\n<td>\n  <a class="played"><span class="label'),played&&__p.push(" label-warning"),__p.push('">Played</span></a>\n  <a class="purchased"><span class="label'),purchased&&__p.push(" label-success "),__p.push('">Purchased</span></a>\n</td>\n');return __p.join("")}}.call(this),Musiclist.Models.Album=Backbone.Model.extend({defaults:{title:"",artist:"",played:!1,purchased:!1}}),Musiclist.Models.Albums=Backbone.Collection.extend({model:Musiclist.Models.Album}),Musiclist.Models.AlbumStatus=Backbone.Model.extend({url:"/album_statuses"}),Musiclist.Models.PlaylistAlbum=Backbone.Model.extend({}),Musiclist.Views.PlaylistAlbum=Backbone.View.extend({tagName:"tr",template:JST["backbone/templates/playlists/album"],events:{"click a.played":"togglePlayed","click a.purchased":"togglePurchased"},initialize:function(){this.model.on("change",this.render,this)},render:function(){return this.$el.html(this.template(this.model.attributes)),this},togglePlayed:function(){this.model.set("played",!this.model.get("played")),this.updateAlbumStatus()},togglePurchased:function(){this.model.set("purchased",!this.model.get("purchased")),this.updateAlbumStatus()},updateAlbumStatus:function(){var t=new Musiclist.Models.AlbumStatus({album_id:this.model.id,played:this.model.get("played"),purchased:this.model.get("purchased")});t.save()}}),Musiclist.Views.PlaylistTable=Backbone.View.extend({events:{"click a.order-album":"orderAlbum","click a.order-artist":"orderArtist","click a.order-position":"orderPosition","change #album-played, #album-purchased, #album-unheard":"changeFilter"},initialize:function(){this.filteredModels=new Musiclist.Models.Albums,this.filteredModels.on("reset",this.renderAlbums,this),this.model.on("reset",this.updateFilter,this)},changeFilter:function(t){t.preventDefault(),this.updateFilter()},orderAlbum:function(t){t.preventDefault(),this.filteredModels.comparator=function(t){return t.get("title").toLowerCase()+"_"+t.get("position")},this.filteredModels.sort()},orderArtist:function(t){t.preventDefault(),this.filteredModels.comparator=function(t){return t.get("artist").toLowerCase()+"_"+t.get("position")},this.filteredModels.sort()},orderPosition:function(t){t.preventDefault(),this.filteredModels.comparator=function(t){return t.get("position")},this.filteredModels.sort()},render:function(){return this.renderAlbums(),this},renderAlbums:function(){var t=this;return this.$("tbody").empty(),this.filteredModels.each(function(e){var n=new Musiclist.Views.PlaylistAlbum({model:e}),i=n.render();t.$("tbody").append(i.el)}),this},updateFilter:function(){var t=this.$("#album-played").is(":checked"),e=this.$("#album-purchased").is(":checked"),n=this.$("#album-unheard").is(":checked");this.filteredModels.reset(this.model.filter(function(i){var r=!1;return t&&(r=r||i.get("played")),e&&(r=r||i.get("purchased")),n&&(r=r||!i.get("played")&&!i.get("purchased")),r}))}}),function(){}.call(this),function(){var t,e=this,n=e.Backbone,i=[],r=i.push,s=i.slice,a=i.splice;t="undefined"!=typeof exports?exports:e.Backbone={},t.VERSION="1.0.0";var o=e._;o||"undefined"==typeof require||(o=require("underscore")),t.$=e.jQuery||e.Zepto||e.ender||e.$,t.noConflict=function(){return e.Backbone=n,this},t.emulateHTTP=!1,t.emulateJSON=!1;var u=t.Events={on:function(t,e,n){if(!c(this,"on",t,[e,n])||!e)return this;this._events||(this._events={});var i=this._events[t]||(this._events[t]=[]);return i.push({callback:e,context:n,ctx:n||this}),this},once:function(t,e,n){if(!c(this,"once",t,[e,n])||!e)return this;var i=this,r=o.once(function(){i.off(t,r),e.apply(this,arguments)});return r._callback=e,this.on(t,r,n)},off:function(t,e,n){var i,r,s,a,u,l,h,d;if(!this._events||!c(this,"off",t,[e,n]))return this;if(!t&&!e&&!n)return this._events={},this;for(a=t?[t]:o.keys(this._events),u=0,l=a.length;l>u;u++)if(t=a[u],s=this._events[t]){if(this._events[t]=i=[],e||n)for(h=0,d=s.length;d>h;h++)r=s[h],(e&&e!==r.callback&&e!==r.callback._callback||n&&n!==r.context)&&i.push(r);i.length||delete this._events[t]}return this},trigger:function(t){if(!this._events)return this;var e=s.call(arguments,1);if(!c(this,"trigger",t,e))return this;var n=this._events[t],i=this._events.all;return n&&h(n,e),i&&h(i,arguments),this},stopListening:function(t,e,n){var i=this._listeners;if(!i)return this;var r=!e&&!n;"object"==typeof e&&(n=this),t&&((i={})[t._listenerId]=t);for(var s in i)i[s].off(e,n,this),r&&delete this._listeners[s];return this}},l=/\s+/,c=function(t,e,n,i){if(!n)return!0;if("object"==typeof n){for(var r in n)t[e].apply(t,[r,n[r]].concat(i));return!1}if(l.test(n)){for(var s=n.split(l),a=0,o=s.length;o>a;a++)t[e].apply(t,[s[a]].concat(i));return!1}return!0},h=function(t,e){var n,i=-1,r=t.length,s=e[0],a=e[1],o=e[2];switch(e.length){case 0:for(;++i<r;)(n=t[i]).callback.call(n.ctx);return;case 1:for(;++i<r;)(n=t[i]).callback.call(n.ctx,s);return;case 2:for(;++i<r;)(n=t[i]).callback.call(n.ctx,s,a);return;case 3:for(;++i<r;)(n=t[i]).callback.call(n.ctx,s,a,o);return;default:for(;++i<r;)(n=t[i]).callback.apply(n.ctx,e)}},d={listenTo:"on",listenToOnce:"once"};o.each(d,function(t,e){u[e]=function(e,n,i){var r=this._listeners||(this._listeners={}),s=e._listenerId||(e._listenerId=o.uniqueId("l"));return r[s]=e,"object"==typeof n&&(i=this),e[t](n,i,this),this}}),u.bind=u.on,u.unbind=u.off,o.extend(t,u);var f=t.Model=function(t,e){var n,i=t||{};e||(e={}),this.cid=o.uniqueId("c"),this.attributes={},o.extend(this,o.pick(e,p)),e.parse&&(i=this.parse(i,e)||{}),(n=o.result(this,"defaults"))&&(i=o.defaults({},i,n)),this.set(i,e),this.changed={},this.initialize.apply(this,arguments)},p=["url","urlRoot","collection"];o.extend(f.prototype,u,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return o.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return o.escape(this.get(t))},has:function(t){return null!=this.get(t)},set:function(t,e,n){var i,r,s,a,u,l,c,h;if(null==t)return this;if("object"==typeof t?(r=t,n=e):(r={})[t]=e,n||(n={}),!this._validate(r,n))return!1;s=n.unset,u=n.silent,a=[],l=this._changing,this._changing=!0,l||(this._previousAttributes=o.clone(this.attributes),this.changed={}),h=this.attributes,c=this._previousAttributes,this.idAttribute in r&&(this.id=r[this.idAttribute]);for(i in r)e=r[i],o.isEqual(h[i],e)||a.push(i),o.isEqual(c[i],e)?delete this.changed[i]:this.changed[i]=e,s?delete h[i]:h[i]=e;if(!u){a.length&&(this._pending=!0);for(var d=0,f=a.length;f>d;d++)this.trigger("change:"+a[d],this,h[a[d]],n)}if(l)return this;if(!u)for(;this._pending;)this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,o.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var n in this.attributes)e[n]=void 0;return this.set(e,o.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!o.isEmpty(this.changed):o.has(this.changed,t)},changedAttributes:function(t){if(!t)return this.hasChanged()?o.clone(this.changed):!1;var e,n=!1,i=this._changing?this._previousAttributes:this.attributes;for(var r in t)o.isEqual(i[r],e=t[r])||((n||(n={}))[r]=e);return n},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return o.clone(this._previousAttributes)},fetch:function(t){t=t?o.clone(t):{},void 0===t.parse&&(t.parse=!0);var e=this,n=t.success;return t.success=function(i){return e.set(e.parse(i,t),t)?(n&&n(e,i,t),e.trigger("sync",e,i,t),void 0):!1},N(this,t),this.sync("read",this,t)},save:function(t,e,n){var i,r,s,a=this.attributes;if(null==t||"object"==typeof t?(i=t,n=e):(i={})[t]=e,!(!i||n&&n.wait||this.set(i,n)))return!1;if(n=o.extend({validate:!0},n),!this._validate(i,n))return!1;i&&n.wait&&(this.attributes=o.extend({},a,i)),void 0===n.parse&&(n.parse=!0);var u=this,l=n.success;return n.success=function(t){u.attributes=a;var e=u.parse(t,n);return n.wait&&(e=o.extend(i||{},e)),o.isObject(e)&&!u.set(e,n)?!1:(l&&l(u,t,n),u.trigger("sync",u,t,n),void 0)},N(this,n),r=this.isNew()?"create":n.patch?"patch":"update","patch"===r&&(n.attrs=i),s=this.sync(r,this,n),i&&n.wait&&(this.attributes=a),s},destroy:function(t){t=t?o.clone(t):{};var e=this,n=t.success,i=function(){e.trigger("destroy",e,e.collection,t)};if(t.success=function(r){(t.wait||e.isNew())&&i(),n&&n(e,r,t),e.isNew()||e.trigger("sync",e,r,t)},this.isNew())return t.success(),!1;N(this,t);var r=this.sync("delete",this,t);return t.wait||i(),r},url:function(){var t=o.result(this,"urlRoot")||o.result(this.collection,"url")||$();return this.isNew()?t:t+("/"===t.charAt(t.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(t){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(t){return this._validate({},o.extend(t||{},{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=o.extend({},this.attributes,t);var n=this.validationError=this.validate(t,e)||null;return n?(this.trigger("invalid",this,n,o.extend(e||{},{validationError:n})),!1):!0}});var g=["keys","values","pairs","invert","pick","omit"];o.each(g,function(t){f.prototype[t]=function(){var e=s.call(arguments);return e.unshift(this.attributes),o[t].apply(o,e)}});var m=t.Collection=function(t,e){e||(e={}),e.url&&(this.url=e.url),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,o.extend({silent:!0},e))},v={add:!0,remove:!0,merge:!0},y={add:!0,merge:!1,remove:!1};o.extend(m.prototype,u,{model:f,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return t.sync.apply(this,arguments)},add:function(t,e){return this.set(t,o.defaults(e||{},y))},remove:function(t,e){t=o.isArray(t)?t.slice():[t],e||(e={});var n,i,r,s;for(n=0,i=t.length;i>n;n++)s=this.get(t[n]),s&&(delete this._byId[s.id],delete this._byId[s.cid],r=this.indexOf(s),this.models.splice(r,1),this.length--,e.silent||(e.index=r,s.trigger("remove",s,this,e)),this._removeReference(s));return this},set:function(t,e){e=o.defaults(e||{},v),e.parse&&(t=this.parse(t,e)),o.isArray(t)||(t=t?[t]:[]);var n,i,s,u,l,c=e.at,h=this.comparator&&null==c&&e.sort!==!1,d=o.isString(this.comparator)?this.comparator:null,f=[],p=[],g={};for(n=0,i=t.length;i>n;n++)(s=this._prepareModel(t[n],e))&&((u=this.get(s))?(e.remove&&(g[u.cid]=!0),e.merge&&(u.set(s.attributes,e),h&&!l&&u.hasChanged(d)&&(l=!0))):e.add&&(f.push(s),s.on("all",this._onModelEvent,this),this._byId[s.cid]=s,null!=s.id&&(this._byId[s.id]=s)));if(e.remove){for(n=0,i=this.length;i>n;++n)g[(s=this.models[n]).cid]||p.push(s);p.length&&this.remove(p,e)}if(f.length&&(h&&(l=!0),this.length+=f.length,null!=c?a.apply(this.models,[c,0].concat(f)):r.apply(this.models,f)),l&&this.sort({silent:!0}),e.silent)return this;for(n=0,i=f.length;i>n;n++)(s=f[n]).trigger("add",s,this,e);return l&&this.trigger("sort",this,e),this},reset:function(t,e){e||(e={});for(var n=0,i=this.models.length;i>n;n++)this._removeReference(this.models[n]);return e.previousModels=this.models,this._reset(),this.add(t,o.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),this},push:function(t,e){return t=this._prepareModel(t,e),this.add(t,o.extend({at:this.length},e)),t},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t),e},unshift:function(t,e){return t=this._prepareModel(t,e),this.add(t,o.extend({at:0},e)),t},shift:function(t){var e=this.at(0);return this.remove(e,t),e},slice:function(t,e){return this.models.slice(t,e)},get:function(t){return null==t?void 0:this._byId[null!=t.id?t.id:t.cid||t]},at:function(t){return this.models[t]},where:function(t,e){return o.isEmpty(t)?e?void 0:[]:this[e?"find":"filter"](function(e){for(var n in t)if(t[n]!==e.get(n))return!1;return!0})},findWhere:function(t){return this.where(t,!0)},sort:function(t){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return t||(t={}),o.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(o.bind(this.comparator,this)),t.silent||this.trigger("sort",this,t),this},sortedIndex:function(t,e,n){e||(e=this.comparator);var i=o.isFunction(e)?e:function(t){return t.get(e)};return o.sortedIndex(this.models,t,i,n)},pluck:function(t){return o.invoke(this.models,"get",t)},fetch:function(t){t=t?o.clone(t):{},void 0===t.parse&&(t.parse=!0);var e=t.success,n=this;return t.success=function(i){var r=t.reset?"reset":"set";n[r](i,t),e&&e(n,i,t),n.trigger("sync",n,i,t)},N(this,t),this.sync("read",this,t)},create:function(t,e){if(e=e?o.clone(e):{},!(t=this._prepareModel(t,e)))return!1;e.wait||this.add(t,e);var n=this,i=e.success;return e.success=function(r){e.wait&&n.add(t,e),i&&i(t,r,e)},t.save(null,e),t},parse:function(t){return t},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){if(t instanceof f)return t.collection||(t.collection=this),t;e||(e={}),e.collection=this;var n=new this.model(t,e);return n._validate(t,e)?n:(this.trigger("invalid",this,t,e),!1)},_removeReference:function(t){this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,n,i){("add"!==t&&"remove"!==t||n===this)&&("destroy"===t&&this.remove(e,i),e&&t==="change:"+e.idAttribute&&(delete this._byId[e.previous(e.idAttribute)],null!=e.id&&(this._byId[e.id]=e)),this.trigger.apply(this,arguments))}});var b=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];o.each(b,function(t){m.prototype[t]=function(){var e=s.call(arguments);return e.unshift(this.models),o[t].apply(o,e)}});var _=["groupBy","countBy","sortBy"];o.each(_,function(t){m.prototype[t]=function(e,n){var i=o.isFunction(e)?e:function(t){return t.get(e)};return o[t](this.models,i,n)}});var w=t.View=function(t){this.cid=o.uniqueId("view"),this._configure(t||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},x=/^(\S+)\s*(.*)$/,E=["model","collection","el","id","attributes","className","tagName","events"];o.extend(w.prototype,u,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,n){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],n!==!1&&this.delegateEvents(),this},delegateEvents:function(t){if(!t&&!(t=o.result(this,"events")))return this;this.undelegateEvents();for(var e in t){var n=t[e];if(o.isFunction(n)||(n=this[t[e]]),n){var i=e.match(x),r=i[1],s=i[2];n=o.bind(n,this),r+=".delegateEvents"+this.cid,""===s?this.$el.on(r,n):this.$el.on(r,s,n)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_configure:function(t){this.options&&(t=o.extend({},o.result(this,"options"),t)),o.extend(this,o.pick(t,E)),this.options=t},_ensureElement:function(){if(this.el)this.setElement(o.result(this,"el"),!1);else{var e=o.extend({},o.result(this,"attributes"));this.id&&(e.id=o.result(this,"id")),this.className&&(e["class"]=o.result(this,"className"));var n=t.$("<"+o.result(this,"tagName")+">").attr(e);this.setElement(n,!1)}}}),t.sync=function(e,n,i){var r=S[e];o.defaults(i||(i={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var s={type:r,dataType:"json"};if(i.url||(s.url=o.result(n,"url")||$()),null!=i.data||!n||"create"!==e&&"update"!==e&&"patch"!==e||(s.contentType="application/json",s.data=JSON.stringify(i.attrs||n.toJSON(i))),i.emulateJSON&&(s.contentType="application/x-www-form-urlencoded",s.data=s.data?{model:s.data}:{}),i.emulateHTTP&&("PUT"===r||"DELETE"===r||"PATCH"===r)){s.type="POST",i.emulateJSON&&(s.data._method=r);var a=i.beforeSend;i.beforeSend=function(t){return t.setRequestHeader("X-HTTP-Method-Override",r),a?a.apply(this,arguments):void 0}}"GET"===s.type||i.emulateJSON||(s.processData=!1),"PATCH"!==s.type||!window.ActiveXObject||window.external&&window.external.msActiveXFilteringEnabled||(s.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var u=i.xhr=t.ajax(o.extend(s,i));return n.trigger("request",n,u,i),u};var S={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var k=t.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},A=/\((.*?)\)/g,j=/(\(\?)?:\w+/g,T=/\*\w+/g,M=/[\-{}\[\]+?.,\\\^$|#\s]/g;o.extend(k.prototype,u,{initialize:function(){},route:function(e,n,i){o.isRegExp(e)||(e=this._routeToRegExp(e)),o.isFunction(n)&&(i=n,n=""),i||(i=this[n]);var r=this;return t.history.route(e,function(s){var a=r._extractParameters(e,s);i&&i.apply(r,a),r.trigger.apply(r,["route:"+n].concat(a)),r.trigger("route",n,a),t.history.trigger("route",r,n,a)}),this},navigate:function(e,n){return t.history.navigate(e,n),this},_bindRoutes:function(){if(this.routes){this.routes=o.result(this,"routes");for(var t,e=o.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(M,"\\$&").replace(A,"(?:$1)?").replace(j,function(t,e){return e?t:"([^/]+)"}).replace(T,"(.*?)"),new RegExp("^"+t+"$")},_extractParameters:function(t,e){var n=t.exec(e).slice(1);return o.map(n,function(t){return t?decodeURIComponent(t):null})}});var O=t.History=function(){this.handlers=[],o.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},I=/^[#\/]|\s+$/g,P=/^\/+|\/+$/g,C=/msie [\w.]+/,F=/\/$/;O.started=!1,o.extend(O.prototype,u,{interval:50,getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getFragment:function(t,e){if(null==t)if(this._hasPushState||!this._wantsHashChange||e){t=this.location.pathname;var n=this.root.replace(F,"");t.indexOf(n)||(t=t.substr(n.length))}else t=this.getHash();return t.replace(I,"")},start:function(e){if(O.started)throw new Error("Backbone.history has already been started");O.started=!0,this.options=o.extend({},{root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var n=this.getFragment(),i=document.documentMode,r=C.exec(navigator.userAgent.toLowerCase())&&(!i||7>=i);this.root=("/"+this.root+"/").replace(P,"/"),r&&this._wantsHashChange&&(this.iframe=t.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(n)),this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!r?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=n;var s=this.location,a=s.pathname.replace(/[^\/]$/,"$&/")===this.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!a?(this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&a&&s.hash&&(this.fragment=this.getHash().replace(I,""),this.history.replaceState({},document.title,this.root+this.fragment+s.search)),this.options.silent?void 0:this.loadUrl())},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),O.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(){var t=this.getFragment();return t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t===this.fragment?!1:(this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash()),void 0)},loadUrl:function(t){var e=this.fragment=this.getFragment(t),n=o.any(this.handlers,function(t){return t.route.test(e)?(t.callback(e),!0):void 0});return n},navigate:function(t,e){if(!O.started)return!1;if(e&&e!==!0||(e={trigger:e}),t=this.getFragment(t||""),this.fragment!==t){this.fragment=t;var n=this.root+t;if(this._hasPushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getFragment(this.getHash(this.iframe))&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,t,e.replace))}e.trigger&&this.loadUrl(t)}},_updateHash:function(t,e,n){if(n){var i=t.href.replace(/(javascript:|#).*$/,"");t.replace(i+"#"+e)}else t.hash="#"+e}}),t.history=new O;var R=function(t,e){var n,i=this;n=t&&o.has(t,"constructor")?t.constructor:function(){return i.apply(this,arguments)},o.extend(n,i,e);var r=function(){this.constructor=n};return r.prototype=i.prototype,n.prototype=new r,t&&o.extend(n.prototype,t),n.__super__=i.prototype,n};f.extend=m.extend=k.extend=w.extend=O.extend=R;var $=function(){throw new Error('A "url" property or function must be specified')},N=function(t,e){var n=e.error;e.error=function(i){n&&n(t,i,e),t.trigger("error",t,i,e)}}}.call(this),$(document).ajaxSend(function(t,e){var n=$("meta[name='csrf-token']").attr("content");e.setRequestHeader("X-CSRF-Token",n)});