<% title @playlist.name, false %>
<% content_for(:head) do %>
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />
<meta name="apple-mobile-web-app-title" content="Musiclist">
<% end %>
<%= content_tag :h2, @playlist.name %>

<dl class="dl-horizontal">
  <dt>Albums:</dt>
  <dd><%= @playlist_albums.count %></dd>
  <dt>Played:</dt>
  <dd><%= AlbumStatus.played.count %></dd>
  <dt>Purchased:</dt>
  <dd><%= AlbumStatus.purchased.count %></dd>
</dl>

<% unless @playlist_albums.empty? %>
<table class="table table-condensed table-striped playlist-table" data-album-statuses-path="<%= album_statuses_path(format: :json) %>">
  <thead>
    <tr>
      <th>&nbsp;</th>
      <th><span class="helper">Sort:</span> <%= link_to 'Position', playlist_path(@playlist, :order => nil) %> | <%= link_to 'Artist', playlist_path(@playlist, :order => 'artist') %> | <%= link_to 'Album', playlist_path(@playlist, :order => 'album') %></th>
      <th class="actions">&nbsp;</th>
    </tr>
  </thead>
  <tbody>
    <!-- Content Replaced by AJAX -->
  </tbody>
</table>
<% end %>

<%= link_to 'Edit', edit_playlist_path(@playlist) %> |
<%= link_to 'Back', playlists_path %>

<% content_for :scripts do %>
<script type="text/javascript">
//<!--
$(function() {
  // $('table.playlist-table').each(function() {
  //   window.playlistTable = new MusicList.PlaylistTable( $(this) );
  // });
  albums = new Musiclist.Models.Albums();

  playlistTable = new Musiclist.Views.PlaylistTable({
    el: $('table.playlist-table tbody'),
    model: albums
  })
  playlistTable.render();

  var preload_albums = <%= render(:partial => 'albums.json.jbuilder', :formats => :json).html_safe %>;
  albums.reset(preload_albums.albums);
});
//-->
</script>
<% end %>